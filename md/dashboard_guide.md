# 账户管理控制台使用指南

在 LeanCloud 平台创建好应用之后，如何查看应用数据，如何查看各服务的使用情况，如何更改应用设置，如何修改账户设置，等等问题，都不可避免要跟我们的「控制台」打交道了。

## 创建应用
对于刚开始接触 LeanCloud 的用户来说，看到的控制台多会是如下图所示的样子：

![firstlook](images/dash_firstlook.png)

在这里显示的内容和操作项简单明了，基本上大家一看就能够操作，例如：

- 我们通过箭头 1 指示的按钮，可以创建新的应用。
- 已经创建好的应用，则显示在箭头 2 指向的区域，包括一些最基本的统计数据也一并展示在了应用卡片中，之后点击这里蓝色的应用名链接，则可以进入单个应用的数据管理和设置页面。
- 箭头 3 指向的是与开发者账户相关的操作链接。

## 管理应用数据
我们在前面页面，在单个应用卡片中点击应用名链接，则可以进入应用数据和配置管理页面，如下图所示：

![app overview](images/dash_appoverview.png)

这里主要分为四块区域：

- 区域 1 显示应用名，并允许我们快速切换应用（点击应用名）。
- 区域 2 按照服务类型，将应用数据做了一级分类。这里分成了存储（包括结构化数据存储、文件存储、云引擎、离线数据分析等功能）、消息（包括实时通信、消息推送和短信服务三种）、分析（应用/用户分析结果展示）、组件（其它扩展组件，如用户反馈、应用内搜索、社交组件等）四个大类，也增加了应用设置菜单。
- 区域 3 则是一级服务下，具体数据、信息组织的二级菜单。
- 区域 4 这里展示具体的数据或者结果信息。

我们重点看看四个一级菜单下的内容。

### 存储服务数据管理

**控制台 > {应用} > 存储** 服务下，包含了四大菜单：

- 「数据」：展示了结构化数据（`AVObject` 及扩展子类）和非结构化数据（`AVFile`）的内容，支持在页面上直接进行增删改查，对于少量的数据维护操作，可以在这里直接进行。
- 「云引擎」：展示了云引擎和云缓存的所有信息，如果需要查看云引擎／云缓存运行状态，部署、增减云引擎／云缓存实例数量，可以在这里直接操作。
- 「API 统计」：这里展示了应用使用数据存储服务的一些统计信息，包括一段时间内存储 API 总的请求量、每天的请求量、按操作类型／class 分类统计的请求量，文件的存储空间和流量变化趋势等等，由于这些数据可以直接反应我们应用的流量和云端性能，能够指导我们进行数据模型和代码优化，同时也与每月账单息息相关，所以请开发者一定仔细查看这里展示的统计数据。
- 「离线数据分析」：标准的增删改查 API 无法一次处理大量数据，所以我们额外提供了这一功能，允许大家通过 SQL 来进行大规模、实时的数据分析和挖掘。

特别地，对于下列数据管理需求，我们都可以在控制台完成：

#### 创建新的 class
进入 **存储 > 数据** 页面，点击「数据」菜单右边的齿轮按钮，可以为应用增加新的 class，如下图所示：
 
![storage - create class](images/dash_storage_data1.png)

在接下来的创建 class 页面中，我们可以指定 class 名字，也可以选择 class 类型：普通表还是[日志表](https://blog.leancloud.cn/3838/)。

#### 本地数据导入 LeanCloud
在上面的页面，大家可以看到「数据导入」菜单，它就是为方便我们批量导入本地数据准备的。详细的数据导入页面如下图所示：

![storage - import data](images/dash_storage_data3.png)

本地文件的格式要求必须是 json 或者 csv 文件，且需要 UTF-8 文件编码。我们支持两种数据导入：

- 导入数据到某个 class，把本地文件内所有的数据都导入到同一个 class 中去。所以如果我们本地有多个 class 的数据，需要按照 class 类别分成多个文件依次导入。
- 导入数据到某个 class 的 relation。relation 是 LeanCloud 数据模型中实现多对多映射的一种方式，细节可以参看[这里的说明](./storage_overview.html#数据关联)。在导入 relation 的时候，我们需要原 class 名字、关联 class 名字、关联属性名等信息。

有关导入数据的详细说明，请参考[文档](./data_security.html#导入数据)。

#### 云端数据导出到本地
LeanCloud 不会把大家强制绑定到自己平台上，所以我们也提供渠道让大家随时把数据导出去，具体操作请看[后文介绍](./dashboard_guide.html)

#### 设置／修改 class 的 ACL 权限

进入 **存储 > 数据** 页面，再进入右侧的数据展示区域，点击上排操作菜单中的「其它」菜单项，可以看到「权限设置」，如下图所示：

![storage - acl](images/dash_storage_data2.png)

对于每一个 class，我们允许对如下几种操作分别授予用户操作权限：

- 增加新的记录（create）
- 删除记录（delete）
- 修改记录（update）
- 指定条件查找记录（find）
- 指定 id 获取单条记录（get）
- 为 class 增加新的属性（add fields）

可以授权访问的用户类型有如下三种：

- 所有用户（表示所有 AVUser 对象，包括匿名用户在内，都拥有访问权限）
- 登录用户（表示只有成功调用 login 的 AVUser 拥有访问权限）
- 指定用户（表示只有少数固定的 AVUser 拥有访问权限）

具体的权限设置可以参考[文档](./data_security.html#Class_级别的权限)。

#### 批量清理一个 class 下的数据
待续

#### 给某个 class 数据建索引
数据查询是很普通的操作，与传统关系型数据库一样，索引的优劣对于我们查询性能的影响非常大。在上图显示的「其它」菜单项中，我们也可以进入「索引」维护界面：

![storage - index](images/dash_storage_data4.png)

注意：

- 这里只能创建唯一索引，对单列索引和组合索引则没有限制。
- LeanCloud 后端智能索引系统会分析你的请求逻辑，自动创建一些索引，来提升数据查询性能。同时，为了支持地理位置信息的查询，我们也会自动对 GeoPoint 属性列创建索引。如果不是你创建的索引请不要进行任何变更操作。
- 由于创建索引是一个非常昂贵的操作，所以如果数据表的记录数超过了 1 万条，请不要自己随意创建索引，可以发送邮件到 support@leancloud.cn 申请索引，由我们系统工程师来帮你创建索引。
- 索引可以有效改善查询性能，但是对于数据插入和修改则是有负作用的，所以是否创建索引、如何创建索引，还需要全面考虑慎重选择。

#### 应用之间共享部分数据
同一个帐户下的其他应用（称为「目标应用」）下的 class（称为「目标 class」）绑定到当前 class，访问当前 class 数据，将会访问到目标应用下的目标 class 数据，这就是我们所谓的「Class 绑定」功能，用来解决应用之间数据共享的需求。最简单的应用就是 _User 表共享，不同应用之间打通帐户，可以相互注册和登录。

在之前显示的「其它」菜单项中，我们可以进入「Class 绑定」界面。当 class 绑定设置好之后，当前 class 绑定之前存储的数据不会丢失，而是被「隐藏」起来，在解除绑定后仍然可以访问到。

#### 云引擎中查看节点运行状态
待续

#### 云引擎中自定义二级域名
待续

#### 云引擎中创建定时器
待续

#### 离线分析结果导出
待续

#### 离线分析的结果存入另一个 class
待续

#### 读懂 API 统计结果
待续


### 消息服务数据管理

**控制台 > {应用} > 消息** 服务下，包含了三大菜单：

- 「实时消息」：这里展示了实时消息服务下一些核心的统计数据，譬如实时在线总用户数、今日累计在线用户数、一段时间内聊天消息／连接峰值的变化趋势等等；同时应用内所有用户的聊天消息也可以一览展示和查询。而且，与聊天相关的一些配置，如 iOS 用户离线推送、消息回调，等，都可以在这里进行设置。
- 「推送」：包含了所有历史推送记录的展示和查询，并且也支持在线进行消息推送／定时推送，也可以在这里设置推送相关的一些配置，例如是否允许客户端推送、iOS 推送证书等等。
- 「短信」：这里可以展示、查询所有短信发送记录，看到短信服务一些核心指标的统计数据，同时也支持短信签名和模版的申请。

特别地，对于下列管理需求，我们都可以在控制台完成：

#### 查询某个用户是否在线
待续

#### 设置 iOS 离线推送配置项
待续

#### 取消尚未开始的定时推送任务
待续

#### 设置多个推送证书
待续

### 分析服务数据展示

**控制台 > {应用} > 分析** 服务下，主要包含了五大菜单：

- 「应用趋势」：展示了部分实时数据和应用关键数据（新增、活跃、累计用户等指标）的变化趋势，能让产品负责人可以一目了然地知道目前产品的概况。
- 「行为分析」：对用户的使用行为进行了具体分析，包括使用时长、访问页面、浏览路径等等，能有效帮助产品经理改善产品设计。
- 「用户分析」：对用户的留存、终端设备和地理分布进行了分析，并且支持对具体的单个用户进行标定、跟踪分析，让你对用户群体无论整体还是个体都有详细的了解。
- 「自定义事件」：对开发者自己打点的事件进行了汇总分析，并结合事件漏斗提供了用户群分析功能。
- 「错误分析」：这里将不同平台、不同版本的应用崩溃信息进行了汇总展示，详细的现场调用堆栈信息可以帮助开发人员尽快定位、修复 bug，也能让产品负责人、产品经理可以看到这个应用的稳定性水平。

### 扩展组件的设置和管理

**控制台 > {应用} > 组件** 服务下，主要包含了三大菜单：

- 「用户反馈」：展示了终端用户对产品的所有反馈，并可以直接在线回复用户，给产品经理和运营人员最大的支持。
- 「应用内搜索」：包含了应用内搜索的一些基本设置信息。
- 「社交」：对于使用了 LeanCloud 社交组件的开发者来说，这里可以直接设置／修改 QQ、微博和微信平台的配置信息。

### 应用设置
**控制台 > {应用} > 设置** 页面，我们可以进行如下操作：
- 「应用基本信息」：
- 「应用 Key」：
- 「安全中心」：
- 「应用选项」：
- 「邮件模版」：
- 「协作者」：
- 「数据导出」：

特别地，对于下列管理需求，我们都可以在控制台完成：

#### 把应用转让给别人
待续

#### 重置遭泄漏的 appKey
待续

#### 个人协作者和团队协作者的区别
待续

#### 细分协作者权限
待续

#### 把应用数据导出到本地
待续


## 开发者账号信息（这里还基本没改）

### 开发者信息
为了更好的服务开发者，建议您完善开发者信息，填写真实姓名、电话号码。比如：
* 在关键时刻（服务宕机等意外情况），我们可以及时与您取得联系，获得更好的服务
* 「技术支持 Ticket」里会用到这些信息
* 发票相关的信息也来自这里

### 邮箱和密码
* 登录时需要邮箱
* 数据导入，数据导出等一些服务会发送邮件通知
* 在「偏好设置」里，可以选择退订邮件（财务和告警类邮件无法退订）。

### 实名认证
新增，待续

### 告警设置
新增，待续

### 偏好设置
新增，待续

### 团队管理
为了方便多人协作，可以创建团队。在单个应用「设置」「协作者」菜单里，可以添加该团队做为当前项目的协作者，这样整个团队的成员都会拥有相关的权限。

## 财务

### 财务概况

- **充值余额**：通过过支付宝或者银行汇款的账户余额。
- **剩余短信**：短信需要单独购买，以购买条数计价。
- **赠送金额**：通过优惠码，代金券等非购买方式得到的，不能用来购买短信。

### 账单
每个月会产生一份账单，包括当前账户下所有应用。会详细展示每个应用每个服务的费用明细。

### 申请发票

请参考 [如何申请发票](faq.html#如何申请开具发票)。

### 充值
账户充值：支持支付宝，和银行转账汇款，请参考 [如何付费](faq.html#如何付费)。账户里面的余额可以用来支付每月账单（每个月结束后自动扣费）。也可以用来购买短信，这个需要主动购买，指定短信条数。
购买短信：短信需要单独购买，这个是实时扣除的，当短信剩余条数偏低时，会通过邮件和短信方式告知开发者。

### 代金券
代金券是一串代码，输入代码后当前帐号会获得相应的金额，您可以通过以下渠道获得代金券：

* 参加我们的黑客马拉松（Hackathon）
* 帮助我们抓 bug
* 各种其他活动

## -------华丽丽的分割线，以下内容都会删掉-------

## 应用列表
包含当前账户创建的所有应用，以及通过设置「协作者」拥有特定权限的应用。

## 存储
包括数据存储、云引擎、API 统计、离线数据分析。

### 数据
可以浏览和管理数据，包括 Class 的创建，删除，数据的增删改查，支持数据导入，[Class 绑定](app_data_share.html)，[应用内搜索](app_search_guide.html)。

选择某个 Class 后即展示当前 Class 相关数据，以及相关功能的操作菜单。

增加 Class 时，名称不允许以下划线开头。以下划线开头的数据表均为系统内置表。

#### 数据浏览

可以通过下面的方法更方便的浏览数据

* 可以通过「列设置」隐藏不需要看到的列
* 点击 ObjectId 快速查看某一行数据
* 可以隐藏 Class 列表，只显示数据部分

#### 数据浏览快捷键

* 方向键(上下左右)/Tab 支持单元格快速切换选中
* Enter 键
 * 当前单元格名称为 ObjectId 时，打开视图窗口
 * 当前单元格类型为 File 时，打开文件窗口

#### 数据编辑
支持所有数据类型的编辑
* 当输入的数据类型没有验证通过，输入完成后不会失去焦点
* Pointer 类型：
 * 新增：输入关联的 ObjectId 即可。保存成功后，生成一个可点击到关联对象的链接
 * 删除：清空后保存即删除 Pointer 列数据
* Relation 类型：
 * 点击某一行数据 Relation 列，跳转到 Relation 相关的 Class。这时候只显示与之相关联的数据
 * 新增：通过 Relation 点击过来，新增的数据即关联到该 Relation
 * 关联已有数据：「关联」菜单下点击 「关联已有对象」，然后选择数据，在选择关联
 * 解除关联关系： 先选中数据，再选择数据关联

#### 数据编辑快捷键

* 双击 Enter，激活当前单元格编辑模式。
* 在单元格编辑模式下，Tab 保存更改，并切换到下一个单元格，Enter 保存修改。

#### 列属性
包括对列的一些操作，包括排序，重命名，编辑属性等。点击每个列右侧向下箭头触发相关菜单。列属性默认值举例如下：

类型|示例
---|---
Number|数字，`100`、`3.1415`
String|字符串，例如 `LeanCloud`
Boolean|布尔值，`true/false`
Date|UTC 时间字符串，格式为 `YYYY-MM-DDTHH:MM:SS.MMMZ`，如 `2015-06-29T01:39:35.931Z`。
Pointer|对象指针，JSON 格式，例如 `{"__type":"Pointer","className":"_User","objectId":"51c3ba67e4b0f0e851c16221"}`。三个属性缺一不可，并且 className 必须跟列的 className 保持一致。
GeoPoint|经纬度，JSON 格式，例如 `{"__type": "GeoPoint","latitude": 39.9,"longitude": 116.4}`。
Array|数组，JSON 格式，例如 `[1, 2 , 3, 'hello world']`。
Object|对象，JSON 格式，例如 `{"name": "LeanCloud", "URL": "https://leancloud.cn"}`。
**Relation**|关联关系，**不支持默认值。**
Any|上述除了 Relation 之外的任何类型的默认值都可以。


#### 数据导入
在页面左侧「数据」链接右侧旁边，点击小齿轮图标即可看到「数据导入」菜单，请参考文档 [导入数据](data_security.html#导入数据)。

### 云引擎

这里主要可以进行云引擎的编辑，部署，制定定时任务，查看日志以及云引擎统计相关信息。

这里的「定义函数」和「Git 部署」是实现云引擎部署相关的两种方式。两种方式不能同时使用。如果要混合使用，会直接部署失败，错误信息：「定义函数」和「Git 部署」功能互斥。如果要继续，需要先清除部署。
#### 定义函数
可以在这个页面编辑云引擎相关函数，请参考 [云引擎指南 - 在线定义函数 Node.js](leanengine_guide-node.html#在线定义函数) / [Python](leanengine_guide-python.html#在线定义函数)。

#### Git 部署
* 点击 **部署**，会发布相应的 **分支** 或 **版本号** 到测试或生产环境中。
* 可以根据 **分支** 或 **版本号** 发布特定版本到测试或生产环境中。

#### 定时任务
对通过前面两种方式定义的云引擎函数，制定定时任务。请参考 [云引擎指南 - 定时任务 Node.js](leanengine_guide-node.html#定时任务) / [Python](leanengine_guide-python.html#定时任务)。

#### 日志
可以查看云引擎的输出日志，区分生产和测试环境。

#### 统计
云引擎相关统计项，可以查看函数，页面相关的调用情况，也可以查看云引擎环境相关运行参数。

### API 统计

API 统计：提供线形图和饼状图两种统计方式
* 线形图帮助查看指定日期范围内，每天的 API 调用量，可以根据平台和 Class 进行筛选。
* 饼状图方便查看指定日内范围内累计 API 调用量。可以按平台，Class 等对比展示。

文件相关 API：
由于存储提供商的限制，文件相关统计可能会一至三天的延迟。

### 离线数据分析
通过 SQL 对数据进行分析。需要先开启「离线数据分析」 选项。分析完成后可以将分析结果保存为 Class 或导出，导出结果限制在 1000 条。

请参考 [离线数据分析使用指南](leaninsight_guide.html)。

## 消息

### 实时消息

#### 统计
* 实时消息使用情况的实时统计
* 实时消息使用情况的历史统计，以天为最小单位

#### 帮助
可以调用实时消息相关 API，查看用户的在线情况，离线消息数量，帮助调试。

#### 设置
包括实时消息相关权限以及其他设置。

### 推送

* 在线发送：通过 web 控制界面发送推送，可以配送各种条件和推送内容。
* 帮助：可以通过界面查看某个 Android 推送设备是否在线，是否有离线消息。
* 推送记录：消息推送的历史记录查询。
* 设置：上传 iOS 证书，以及其他推送相关的权限设置

## 分析
* 支持各种常见统计指标
* 支持按照系统类型，系统版本，发布渠道，应用版本，自定义用户群，时间段进行统计，支持按时间段对比分析（仅限对有对比意义的统计项）
* 支持实时统计一些关键数据
* 支持全部系统的汇总统计（仅限对于全部系统都有意义的统计项）
* 支持自定义事件统计
* 支持自定义用户群，可以作为其他统计项的筛选条件，也可以结合「推送」使用，在「用户群」里，通过筛选用户，然后对筛选后的用户进行推送
* 每个统计展示页都有详细的统计项说明。对于需要进行编码设置才起作用的统计项，在没收到统计数据的时候，会给出具体的相关文档链接

## 组件

### 用户反馈
通过结合使用客户端 sdk，和 Web 管理页面，实现用户反馈管理功能。主要是在客户端通过 SDK 提交反馈，获取反馈，在 Web 页面里进行回复以及用户反馈的管理。

### 自定义参数
通过 Web 管理页面设置参数名，参数值，然后在客户端通过 SDK 读取配置的参数值。

### 应用内搜索
类似全文搜索，在这里需要设置一些基本信息，[相关文档](app_search_guide.html)。

### 社交
这里需要设置第三方平台的认证信息，以完成社交「登录」功能。

## 设置


### 基本信息
应用名称：不对外公开，在系统内部使用。

应用墙发布设置：审核通过后，审核结果将以邮件的形式通知到用户，并发布到 [我们的用户页面](/customers.html)。

### 应用 Key
用于标识 App 身份信息。
* App ID：全局唯一的应用 ID
* App Key：用于 App 基本安全认证
* Master Key：用于 App 超级权限认证

不要泄露 App Key ，特别是 Master Key。Master Key 会绕过所有 ACL 和 Class 权限等授权校验。

### 应用选项
集成了各种服务权限相关选项设置。
### 邮件模板
包括用于邮箱验证，重置密码的邮件模板设置。
### 短信模板
* 模板审核通过后立即生效
* 可以创建同名模板，在审核通过后将覆盖老的模板，审核期间，已经审核通过的老模板继续可用，审核通过即刻替换

### 协作者
用于项目协作，可以给相关个人账户和团队设置授予特定权限，访问当前项目。

### 数据导出
导出成功后，数据将发送到当前用户的邮箱。当数据量较大时，较为耗时，所以建议加上开始结束日期限制（按 updatedAt 计算），也可以限定特定 Class 导出。
